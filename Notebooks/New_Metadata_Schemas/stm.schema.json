{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://example.com/stm.schema.json",
    "title": "STM",
    "openBISCode": "STM",
    "description": "An STM",
    "type": "object",
    "properties": {
        "name": {
            "title": "Name",
            "type": "string",
            "openBISType": "VARCHAR",
            "description": "Name"
        },
        "recording_time": {
            "title": "Recording time",
            "type": "string",
            "openBISType": "TIMESTAMP",
            "description": "Recording time",
            "format": "date-time"
        },
        "duration": {
            "title": "Duration",
            "type": "object",
            "openBISType": "JSON",
            "description": "Duration",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "bias_settings": {
            "title": "Bias settings",
            "type": "object",
            "openBISType": "JSON",
            "description": "Bias voltage settings",
            "properties": {
                "setpoint": {
                    "type": "object",
                    "description": "Setpoint",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "calibration_factor": {
                    "type": "object",
                    "description": "Calibration factor",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "calibration_offset": {
                    "type": "object",
                    "description": "Calibration offset",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "current_settings": {
            "title": "Current settings",
            "type": "object",
            "openBISType": "JSON",
            "description": "Current settings",
            "properties": {
                "setpoint": {
                    "type": "object",
                    "description": "Setpoint",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "calibration_factor": {
                    "type": "object",
                    "description": "Calibration factor",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "calibration_offset": {
                    "type": "object",
                    "description": "Calibration offset",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "gain": {
                    "type": "number",
                    "description": "Gain"
                }
            }
        },
        "z": {
            "title": "Z",
            "type": "object",
            "openBISType": "JSON",
            "description": "Tip position in Z axis",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "feedback_settings": {
            "title": "Feedback settings",
            "type": "object",
            "openBISType": "JSON",
            "description": "Feedback settings",
            "properties": {
                "feedback_active": {
                    "type": "string",
                    "description": "Whether feedback is active",
                    "enum": ["active", "inactive"]
                },
                "feedback_type": {
                    "type": "string",
                    "description": "Feedback type",
                    "enum": ["Log current", "Abs current"]
                }
            }
        },
        "z_controller_settings": {
            "title": "Z-controller settings",
            "type": "object",
            "openBISType": "JSON",
            "description": "Z-Controller settings.",
            "properties": {
                "setpoint": {
                    "type": "object",
                    "description": "Setpoint",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "p_gain": {
                    "type": "number",
                    "description": "Proportional gain"
                },
                "i_gain": {
                    "type": "number",
                    "description": "Integral gain"
                },
                "time_constant": {
                    "type": "object",
                    "description": "Time constant",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "tip_lift": {
                    "type": "object",
                    "description": "Position of the tip when feedback loop is off",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "switch_off_delay": {
                    "type": "object",
                    "description": "Time delay applied when switching off feedback loop",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "piezo_configuration_settings": {
            "title": "Piezo configuration settings",
            "type": "object",
            "openBISType": "JSON",
            "description": "Piezo configuration settings.",
            "properties": {
                "active_calib": {
                    "type": "string",
                    "description": "Setpoint",
                    "enum": ["LHe"]
                },
                "sensitivity": {
                    "type": "object",
                    "description": "Sensitivity",
                    "properties": {
                        "x": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        },
                        "y": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        },
                        "z": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        }
                    }
                },
                "hv_gain": {
                    "type": "object",
                    "description": "HV Gain",
                    "properties": {
                        "x": {
                            "type": "number"
                        },
                        "y": {
                            "type": "number"
                        },
                        "z": {
                            "type": "number"
                        }
                    }
                },
                "scan_slope": {
                    "type": "object",
                    "description": "Scan slope",
                    "properties": {
                        "x": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        },
                        "y": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        }
                    }
                },
                "curvature_radius": {
                    "type": "object",
                    "description": "Curvature radius",
                    "properties": {
                        "x": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        },
                        "y": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        }
                    }
                },
                "second_order_correction": {
                    "type": "object",
                    "description": "2nd order correction",
                    "properties": {
                        "x": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        },
                        "y": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        }
                    }
                },
                "drift": {
                    "type": "object",
                    "description": "Drift",
                    "properties": {
                        "x": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        },
                        "y": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        },
                        "z": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        }
                    }
                },
                "drift_correction_status": {
                    "type": "boolean",
                    "description": "Whether the drift correction is performed"
                }
            }
        },
        "scan_settings": {
            "title": "Scan settings",
            "type": "object",
            "openBISType": "JSON",
            "description": "Scan settings",
            "properties": {
                "field": {
                    "type": "array",
                    "items": {
                        "type": "number"
                    },
                    "description": "The scanfield of the image"
                },
                "angle": {
                    "type": "object",
                    "description": "Angle",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "offset": {
                    "type": "object",
                    "description": "Offset",
                    "properties": {
                        "x": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        },
                        "y": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        }
                    }
                },
                "time": {
                    "type": "object",
                    "description": "Time",
                    "properties": {
                        "x": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        },
                        "y": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        }
                    }
                },
                "range": {
                    "type": "object",
                    "description": "Range",
                    "properties": {
                        "x": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        },
                        "y": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        }
                    }
                },
                "pixels": {
                    "type": "object",
                    "description": "Pixels",
                    "properties": {
                        "x": {
                            "type": "number"
                        },
                        "y": {
                            "type": "number"
                        }
                    }
                },
                "speed": {
                    "type": "object",
                    "description": "Speed",
                    "properties": {
                        "forward": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        },
                        "backwards": {
                            "type": "object",
                            "properties": {
                                "value": {
                                    "type": "number"
                                },
                                "unit": {
                                    "type": "string"
                                }
                            }
                        }
                    }
                },
                "direction": {
                    "type": "string",
                    "description": "Direction",
                    "enum": ["down", "both"]
                }
            }
        },
        "dwell_time": {
            "title": "Dwell time",
            "type": "object",
            "openBISType": "JSON",
            "description": "Dwell time",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "sample_temperature": {
            "title": "Sample temperature",
            "type": "object",
            "description": "Sample temperature",
            "openBISType": "JSON",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "recording_temperature": {
            "title": "Room temperature",
            "type": "object",
            "description": "Room temperature",
            "openBISType": "JSON",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "e_min": {
            "title": "E-min",
            "type": "object",
            "description": "Energy of the lowest orbital included in the calculation",
            "openBISType": "JSON",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "e_max": {
            "title": "E-max",
            "type": "object",
            "description": "Energy of the highest orbital included in the calculation",
            "openBISType": "JSON",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "de": {
            "title": "dE",
            "type": "object",
            "description": "Step between the E-min and E-max",
            "openBISType": "JSON",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "fwhm": {
            "title": "FWHM",
            "type": "object",
            "description": "Full width at half maximum",
            "openBISType": "JSON",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "extrap_plane": {
            "title": "Extrapolation Plane",
            "type": "object",
            "description": "Position of the extrapolation place",
            "openBISType": "JSON",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "constant_height": {
            "title": "Constant height",
            "type": "object",
            "description": "Distance from the surface at which the constant Z image is simulated",
            "openBISType": "JSON",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "constant_current": {
            "title": "Constant current",
            "type": "object",
            "description": "Isovalue of charged density at which the constant current image is produced",
            "openBISType": "JSON",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "wfms_uuid": {
            "title": "WFMS UUID",
            "type": "string",
            "openBISType": "VARCHAR",
            "description": "Unique identifier of the simulation object in the WFMS"
        },
        "comments": {
            "title": "Comments",
            "type": "string",
            "openBISType": "MULTILINE_VARCHAR",
            "description": "Comments"
        },
        "annealing": {
            "$ref": "./annealing.schema.json",
            "description": "Details about the annealing before the STM"
        },
        "deposition": {
            "$ref": "./deposition.schema.json",
            "description": "Details about the deposition before the STM"
        },
        "dft": {
            "$ref": "./dft.schema.json",
            "description": "Details about the DFT parameters"
        },
        "tb": {
            "$ref": "./tb.schema.json",
            "description": "Details about the TB parameters"
        }
    },
    "additionalProperties": false,
    "required": ["name", "recording_time", "duration", "bias_settings", "current_settings", "z"]
}
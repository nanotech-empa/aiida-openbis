{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://example.com/sts.schema.json",
    "title": "STS",
    "openBISCode": "STS",
    "description": "An STS",
    "type": "object",
    "properties": {
        "name": {
            "title": "Name",
            "type": "string",
            "openBISType": "VARCHAR",
            "description": "Name"
        },
        "recording_time": {
            "title": "Recording time",
            "type": "string",
            "openBISType": "TIMESTAMP",
            "description": "Recording time",
            "format": "date-time"
        },
        "duration": {
            "title": "Duration",
            "type": "object",
            "openBISType": "JSON",
            "description": "Duration",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "experiment_type": {
            "title": "Experiment type",
            "type": "string",
            "openBISType": "CONTROLLEDVOCABULARY",
            "description": "Experiment type",
            "enum": ["Bias spectroscopy", "Z-spectroscopy"]
        },
        "acquisition_coordinates": {
            "title": "Acquisition coordinates",
            "type": "object",
            "openBISType": "JSON",
            "description": "Acquisition coordinates",
            "properties": {
                "x": {
                    "type": "object",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "y": {
                    "type": "object",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "z": {
                    "type": "object",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "feedback_active": {
            "title": "Feedback active",
            "type": "string",
            "openBISType": "CONTROLLEDVOCABULARY",
            "description": "Whether feedback is active",
            "enum": ["active", "inactive"]
        },
        "final_z": {
            "title": "Final Z",
            "type": "object",
            "openBISType": "JSON",
            "description": "Final Z",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "filter_type": {
            "title": "Filter type",
            "type": "string",
            "openBISType": "CONTROLLEDVOCABULARY",
            "description": "Filter type",
            "enum": ["Butterworth"]
        },
        "filter_order": {
            "title": "Filter order",
            "type": "integer",
            "openBISType": "INTEGER",
            "description": "Filter order",
            "minimum": 1
        },
        "filter_cutoff": {
            "title": "Filter cutoff",
            "type": "object",
            "openBISType": "JSON",
            "description": "Filter cutoff",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "bias_settings": {
            "title": "Bias settings",
            "type": "object",
            "openBISType": "JSON",
            "description": "Bias voltage settings",
            "properties": {
                "setpoint": {
                    "type": "object",
                    "description": "Setpoint",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "calibration_factor": {
                    "type": "object",
                    "description": "Calibration factor",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "calibration_offset": {
                    "type": "object",
                    "description": "Calibration offset",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "num_pixel": {
            "title": "Number of pixels",
            "type": "integer",
            "minimum": 1,
            "openBISType": "INTEGER",
            "description": "Number of recorded points"
        },
        "z_avg_time": {
            "title": "Z average time",
            "minimum": 0,
            "type": "object",
            "openBISType": "JSON",
            "description": "Duration over which the Z position is recorded and averaged before and after the sweep",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "first_settling_time": {
            "title": "First settling time",
            "type": "object",
            "openBISType": "JSON",
            "description": "Additional time to wait (in addition to the Settling Time) after the bias has ramped to the starting point of the sweep",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "settling_time": {
            "title": "Settling time",
            "type": "object",
            "openBISType": "JSON",
            "description": "Time to wait after changing the bias to the next level and before starting to acquire data",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "integration_time": {
            "title": "Integration time",
            "type": "object",
            "openBISType": "JSON",
            "description": "Time during which the data are acquired and averaged",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "end_settling_time": {
            "title": "End settling time",
            "type": "object",
            "openBISType": "JSON",
            "description": "Time to wait after the sweep has finished and the bias is ramped to the initial value",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "z_control_time": {
            "title": "Z-Controller time",
            "type": "object",
            "openBISType": "JSON",
            "description": "Time during which the Z-controller is enabled once a sweep has finished",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "max_slew_rate": {
            "title": "Max slew rate",
            "type": "object",
            "openBISType": "JSON",
            "description": "Max rate at which the bias changes (before, during and after sweeping)",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "backward_sweep": {
            "title": "Backward sweep",
            "type": "boolean",
            "openBISType": "BOOLEAN",
            "description": "Whether one wants to measure the backward (return) sweep or the forward only"
        },
        "num_sweeps": {
            "title": "Number of sweeps",
            "minimum": 0,
            "type": "integer",
            "openBISType": "INTEGER",
            "description": "Number of sweeps to measure and average"
        },
        "channel_names": {
            "title": "Channel names",
            "type": "array",
            "openBISType": "ARRAY_STRING",
            "items": {
                "type": "string"
            },
            "description": "Recorded channel names"
        },
        "record_final_z": {
            "title": "Record final Z",
            "type": "boolean",
            "openBISType": "BOOLEAN",
            "description": "Record the Z position during Z averaging time at the end of the sweep (after Z control time)"
        },
        "lock_in_run": {
            "title": "Lock-in run",
            "type": "integer",
            "openBISType": "INTEGER",
            "description": "Lock-in to run during the measurement"
        },
        "bias_spectroscopy_settings": {
            "title": "Bias spectroscopy settings",
            "type": "object",
            "openBISType": "JSON",
            "description": "Bias spectroscopy settings",
            "properties": {
                "reset_bias": {
                    "type": "boolean",
                    "description": "Reset bias to the initial value (before starting the sweep) at the end of the spectroscopy measurement"
                },
                "sweep_start": {
                    "type": "object",
                    "description": "Sweep start",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "sweep_end": {
                    "type": "object",
                    "description": "Sweep end",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "z_offset": {
                    "type": "object",
                    "description": "Z offset",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "z_controller_hold": {
                    "type": "boolean",
                    "description": "If Z-controller is being used"
                }
            }
        },
        "z_spectroscopy_settings": {
            "title": "Z spectroscopy settings",
            "type": "object",
            "openBISType": "JSON",
            "description": "Z-spectroscopy settings",
            "properties": {
                "reset_z": {
                    "type": "boolean",
                    "description": "Reset the Z position at the end of the sweep to the initial averaged value calculated during Z averaging time at Max slew rate"
                },
                "initial_z_offset": {
                    "type": "object",
                    "description": "Initial Z offset",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "sweep_distance": {
                    "type": "object",
                    "description": "Sweep distance",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "time_between_forward_backward": {
                    "type": "object",
                    "description": "Time to wait in seconds between the forward and the backward sweep",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "current_settings": {
            "title": "Current settings",
            "type": "object",
            "openBISType": "JSON",
            "description": "Current settings",
            "properties": {
                "setpoint": {
                    "type": "object",
                    "description": "Setpoint",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "calibration_factor": {
                    "type": "object",
                    "description": "Calibration factor",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "calibration_offset": {
                    "type": "object",
                    "description": "Calibration offset",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "gain": {
                    "type": "number",
                    "description": "Gain"
                }
            }
        },
        "z": {
            "title": "Z",
            "type": "object",
            "openBISType": "JSON",
            "description": "Tip position in Z axis",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "feedback_settings": {
            "title": "Feedback settings",
            "type": "object",
            "openBISType": "JSON",
            "description": "Feedback settings.",
            "properties": {
                "feedback_active": {
                    "type": "string",
                    "description": "Whether feedback is active",
                    "enum": ["active", "inactive"]
                },
                "feedback_type": {
                    "type": "string",
                    "description": "Feedback type",
                    "enum": ["Log current", "Abs current"]
                }
            }
        },
        "z_controller_settings": {
            "title": "Z-controller settings",
            "type": "object",
            "openBISType": "JSON",
            "description": "Z-Controller settings",
            "properties": {
                "setpoint": {
                    "type": "object",
                    "description": "Setpoint",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "p_gain": {
                    "type": "number",
                    "description": "Proportional gain"
                },
                "i_gain": {
                    "type": "number",
                    "description": "Integral gain"
                },
                "time_constant": {
                    "type": "object",
                    "description": "Time constant",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "tip_lift": {
                    "type": "object",
                    "description": "Position of the tip when feedback loop is off",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "switch_off_delay": {
                    "type": "object",
                    "description": "Time delay applied when switching off feedback loop",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "lock_in_settings": {
            "title": "Lock-in settings",
            "type": "object",
            "openBISType": "JSON",
            "description": "Piezo configuration settings",
            "properties": {
                "status": {
                    "type": "boolean",
                    "description": "If lock-in is on or not."
                },
                "modulated_signal": {
                    "type": "string",
                    "description": "Signal on which the modulation (sine) will be added"
                },
                "frequency": {
                    "type": "object",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "amplitude": {
                    "type": "object",
                    "properties": {
                        "value": {
                            "type": "number"
                        },
                        "unit": {
                            "type": "string"
                        }
                    }
                },
                "demodulated_signal": {
                    "type": "string",
                    "description": "Signal which will be demodulated",
                    "enum": ["Current"]
                },
                "hp_filter_cutoffs": {
                    "type": "array",
                    "description": "Cutoff frequency of the high-pass filter applied on the demodulation signal",
                    "items": {
                        "type": "object",
                        "properties": {
                            "value": {
                                "type": "number"
                            },
                            "unit": {
                                "type": "string"
                            }
                        }
                    }
                },
                "hp_filter_orders": {
                    "type": "array",
                    "description": "Cutoff frequency of the high-pass filter applied on the demodulation signal",
                    "items": {
                        "type": "integer",
                        "minimum": 0
                    }
                },
                "harmonics": {
                    "type": "array",
                    "description": "Order of the harmonic oscillation to detect on the demodulated signal",
                    "items": {
                        "type": "integer",
                        "minimum": 0
                    }
                },
                "reference_phases": {
                    "type": "array",
                    "description": "Reference phase for the sine on the demodulated signal with respect to the modulation signal",
                    "items": {
                        "type": "object",
                        "properties": {
                            "value": {
                                "type": "number"
                            },
                            "unit": {
                                "type": "string"
                            }
                        }
                    }
                },
                "lp_filter_cutoffs": {
                    "type": "array",
                    "description": "Cutoff frequency of the low-pass filter applied on the demodulation signal",
                    "items": {
                        "type": "object",
                        "properties": {
                            "value": {
                                "type": "number"
                            },
                            "unit": {
                                "type": "string"
                            }
                        }
                    }
                },
                "lp_filter_orders": {
                    "type": "array",
                    "description": "Cutoff frequency of the low-pass filter applied on the demodulation signal",
                    "items": {
                        "type": "integer",
                        "minimum": 0
                    }
                },
                "sync_filter": {
                    "type": "boolean",
                    "description": "If use sync filter (Operates after the low-pass filter and averages the demodulated signals over one period of the modulation frequency"
                }
            }
        },
        "sample_temperature": {
            "title": "Sample temperature",
            "description": "Sample temperature",
            "type": "object",
            "openBISType": "JSON",
            "properties": {
                "value": {
                    "type": "number"
                },
                "unit": {
                    "type": "string"
                }
            }
        },
        "wfms_uuid": {
            "title": "WFMS UUID",
            "type": "string",
            "openBISType": "VARCHAR",
            "description": "Unique identifier of the simulation object in the WFMS"
        },
        "comments": {
            "title": "Comments",
            "type": "string",
            "openBISType": "MULTILINE_VARCHAR",
            "description": "Comments"
        },
        "annealing": {
            "$ref": "./annealing.schema.json",
            "description": "Details about the annealing before the STS"
        },
        "deposition": {
            "$ref": "./deposition.schema.json",
            "description": "Details about the deposition before the STS"
        }
    },
    "additionalProperties": false,
    "required": ["name", "recording_time", "duration", "bias_settings", "current_settings", "z"]
}
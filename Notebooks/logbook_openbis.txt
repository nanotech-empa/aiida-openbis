Questions:

- When creating a new space, how to place it inside lab notebook or inventory? Using pyBIS
- Why do I need to update the microscopy app even if it is the first time I upload some images
- What is needed to fill the RO-Crate. Atm I have Json-LD and Json Schema. What is missing?
- I developed a way of automatically selecting the measurement channels following a set of rules written by experimentalists. Are you going to incorporate that in the app?
- Is the next openBIS release going to be plug-and-play? At the moment, I need to set up some settings to have microscopy app running, e.g., installing python 3.

- Unzipping a zip file in pybis dataset does not work right? [CLOSED]
- In microscopy app, DAT files are now together in just one object. However, each data file has a different header. How are you going to handle this? [CLOSED]

Notes: 

One can upload sxm and dat files to the same collection in openBIS. 
One just has to create a TEMPLATE-SXM and a TEMPLATE-DAT samples inside the collection and then change the experiment and sample inside nanonis_importer.py.
Bug in nanonis_importer on line 147. As it was getting all the possible channels from the files before getting the minimum and maximum of the files, there were some cases
where the channels did not exist and it was throwing a ValueError when using .index() in the list inside the function get_channel in spmpy_terry.py

Discussion about STM datasets:

Each STM session should be independent:
- Contains several SXM and several DAT and all of them go into the same view. If there are another session, it goes to another view.
- Check whether the openbis microscopy app follows the trees discussed at the beginning of PREMISE (SXM and DAT files trees)
- SXM and DAT files should be mixed and sequential.
- Replicate a small set of files that Bruno or Lysandr can give us.

Bug in microscopy app scripts:
- bug with div_00003.dat and 00004.dat
- Correct the python code (talk with Lysandr if needed)

2-8-2024:
Create the STM objects inside a collection in the project and then make these objects children of experiment step objects like Annealling, etc.
Changed math to numpy in nanonis_importer.py.
Added 'LI Demod 1 Y (A)','LI Demod 1 Y (A) [bwd] (A)' to channel names together with the respective elements to the other 3 groups??? Ask Lysandr
Change STM, AFM, STS, etc by 1D Measurements, 2D Measurements, 3D Measurements....
Bruno asked to present examples of how to build a Sample Preparation/Sample in openBIS.

5-8-2024:
How to store a sample preparation:
1- Store sample preparation tasks without making a specific object for sample. Connect measurements to the last sample preparation task.
2- Create a sample object and then connect the measurements to the last sample preparation task.
3- Create a Sample preparation object and connect sample object to it. Then connect sample to measurements.
4- Create a sample preparation object and no sample objects. Connect measurement to sample preparation object.

6-8-2024:
Search for ontologies and complete more fields.

8-8-2024:
What is the difference between net charge and charge? In Schema
Updated the presentation for September

Save the conversation with one theory scientist (It was not done on the 8th): 
Change quantitative value to has_measurement_unit?
Use slot_usage to put required in all mandatory attributes (Verify)

 Tight Binding
 - xyz -> atom coords
 - lattice vectors (max 3 vectors)
 - k-points -> vector with 3 doubles >>> always defined between 0 and 2pi
 - lattice: honeycomb is the most used in our case but could be undefined
 - hoppings (doubles but can be complex numbers) [Energy units]
 - hamiltonian (complex numbers) hermitian matrix [Energy units] or functions (in the case of the crystal) ?? output ??
 - comments

 Mean Field Hubbard
 - tight binding (link to TB)
 - on site Hubbard repulsion U (double) [Energy units] so um valor
 - density tolerance (double)  [No unit]
 - number of electrons or charge (-1, 0, +1)
 - up densities -> matrix dimension (number of columns) [No unit]
 - down densities -> matrix dimension (number of columns) [No unit]
 - number of electrons up and the number of electrons down (integer)
 - convergence_coefficient - help with the convergence of the solution (double)
 - number of k-points used in the integral (integer)
 - comments 
 
 Simulation object with general info

 3-9-2024:
 Discussion with Bruno: 
 - For every preparation, there should be a gallery with all SXM and Dat files.
 - The files should be displayed chronologically.
 - If Dat files come together, they should be merged into just one plot.
 - One should be able to split the merged dat files afterwards if needed.

 Sample objects conclusion (Discuss it in the meeting next week): 
 - Create a new sample object after every sample preparation task like (Sample 1 > Task > Sample 1.1)
 - Connect the measurements to the last sample object.

 Should I do one collection with measurements for all the measurements in the project or should I make a collection for every sample preparation?

 Store consecutive dat files together. There might be a case where dat files with an sxm image in-between should be merged but it is ok if it is not possible.

 nanonis_importer.py is now placing the measurement chronologically, merging dat files whenever they are consecutive.
+
 IMPORTANT: The exact location of the dat measurements in the sample should appear in the microscopy app? -> Discuss with Bruno and probably openBIS team.

 IMPORTANT: One measurement collection per sample preparation.

 DISCUSS WITH BRUNO: On the slide 5 of the G:\openBIS\ORD PREMISE\GUI, Style File\Lab205_microscopy_GUI_initial_concept.pptx, there is an image where the experimentalists combine dat measurements with an SXM measurement. To select the SXM measurement, we could take the coordinates of the dat measurements and try to find the best SXM match (one where the coords are not out of range). There should also be a manual option.

 Working on inventory excel. -> Trying to replicate it inside openBIS.
 Working on how the default channels are selected when uploading measurement files to openBIS.

4-9-2024:
Working on the selection of default channels for the measurements. If dat files that were taken together correspond to different measurement types, they should be grouped by type.
Working on the mapping of the instruments' excel metadata into openBIS.

5-9-2024:
Talked with Edan about the PREMISE' tasks. I should ask Bruno whether they trigger simulations using information from the experiments, e.g. using the same parameters used in the lab to build a certain sample.

6-9-2024:
What should be stored in a transference? Room to Room or Location to Location? Location is the exactly place where the item is, like inside a drawer or inside an instrument.
Start preparing the different options to store components and instruments in openBIS. An option would be to have collections of those options in headings and those options in subheadings and then relate them. Another option is to enter that information as object properties.
IMPORTANT: There is no option for entering an array of objects as object property.

9-9-2024:

Prepared slides in the presentation for wednesday using two different approachers of storing inventory metadata.
Prepared RO-Crate for the discussion with Mihai.

10-9-2024:

Meeting with Carlo: 
- Missing the instrument mapping into openBIS (being done with iLog project)
- Missing first deep benchmarking with experimentalists (Planned on mid December)
- Need to refine our object structures to consider the logging (object tracking, maintenance, etc)
- Missing simulation side mapping
- Decide how to deal with cases when simulation starts from aiida
- Decide about interoperability (where to start)
- Implement missing features in the microscopy app (e.g. pointing 1D measurements on 2D measurements)
- The openbis container does not work in macOS

11-9-2024:

Meeting with Bruno and meeting with Mihai, Adam, Edan, and Nukorn to discuss LinkML

12-9-2024:

Discuss Microscopy app with Bruno and ask him about creating an aiida simulation using sample information

Bruno's questions:
    How do they populate the gallery (image data)?
    What is the difference between the images and previews inside the microscopy app?
    We need a button to return to the galley and buttons to move through the different measurement inside the same gallery.
    
    Ask Simone about this: Who is in charge of the automatic import? Selection of the correct collection and correct sample.
    Jupyter notebook to display measurements (check https://github.com/nanotech-empa/simpleNFB). Ask Eve about details.
    Create a meeting with me, Carlo, Bruno, and developers from openBIS

13-9-2024:

- Converted information from the JSON-LD provided by Nukorn to LinkML. 
It is possible to put almost everything inside the LinkML. 
There is just one thing that I am not getting how to do that, that is specifying the type of the object using @type. 
At the moment, by using designates_type, it creates type inside JSON-LD. However, the type is considered as a class and not as @type, as it is done with the id.
I also have to discuss with Nukorn about the @reverse that appears in the JSON-LD file.

IMPORTANT: I attended a meeting (openBIS community). In that meeting, a project called openBISmantic was presented. In this project they use RO-crate to import/export things from openBIS.

Update our LinkML schema: Change property names such as molecule and crystal to has_molecule and has_crystal. Continue next week.

16-9-2024:

Update LinkML schema.
Create a Jupyter notebook to register new sample preparations:
- Create a new sample (Create a new experiment with sample preparation and create a new sample in the sample collection)
- Sputter sample (Sputtering object and create a new sample after the sputtering. Link also the instrument)
- Anneal sample (Annealing object and ....)
- Deposition on sample (Deposition object, molecule, etc.)
- Upload a measurement.
- Every time I need to upload a value with an unit, lets allow the user to select out of a list?

17-9-2024:

Working on the openbis connection app (sample preparation and measurement)

24-9-2024:

Meeting with Carlo

- Create sample:
> Check whether sample name is already existant. (Done)
> Autocompletion libraries for text boxes where researchers have to write, e.g., names.

Sputtering:
> Order the experiment by reversed time. (Done)
> If we select a sample, the experiment is automatically selected. When there is a sample that belongs to two experiments, just show these two on the dropdown.
> Sample out name should be proposed by the system and then the researcher should be allowed to change. (Done)
> Edit objects

25-9-2024:
Worked on openbis connection app

26-9-2024:
Worked on openbis connection app
Work on openbis setup script. Objects should be placed as a property type of other objects instead of parent-child connection. This last one should one be used for processes and samples.

27-9-2024:
Converged all importer scripts into just one file.

30-9-2024:
Generalise code and remove repetitions from the experiment uploader app.

Meeting with Carlo (30/09/2024)

- When the images are uploaded into openBIS, if it is not possible to generate the image (square with a cross in the middle), create a button to refresh all of them.
- From the preview, we need a button to go back to the gallery view. 
- From the preview, we would like to have two buttons (two arrows) to move among the different datasets present in the gallery.
- On the preview/object view, metadata is missing (there is no parameters, etc.). Concerning the parameters, if we have multiple dat files, what happens? Are they shared among all of them?
- Comments should be editable.
- What is the difference between images and previews (Preview view).

- "Reference plot" panel with the 2D measurement added to the 1D measurements. What should be visualised? Use functionalities (Ask Bruno lab).
- Integrate the automatic selection of measurement channels into the microscopy app python scripts. Additionally, update the script to use the new libraries developed by Bruno's lab. 
- What should be entered when uploading an image from matthias,
- I should be able to upload an image directly from the file and not from the command line, like uploading a dataset.
- Image plugin should be added by default to openBIS instead of having to add it to the plugin list.

- Ask Sasha about the connection to openBIS on the backend.
- To discuss with Bruno: What should be in property type list and what should be seen in hierarchy graph?


3-10-2024:

Elog notes:
    - Fill Cryostat: Dewar, weight before and after, substance, instrument, comments
    - System Status (Pressure reading): Instrument with plots, comments
    - Errors and Problems: Instrument, comments, sample
    - Transfer: Place before, Place after, sample
    - Sample Preparation (Other): Instrument, sample, comments
    - Comment/Note: comments, instrument, sample
    - Maintenance: comments, instrument, sample
    - Calibration/Optimisation: comments, instrument, technique (QCM), sample, PC-pressure, rate (Ang/min), Temperature, Evaporator slot, PID
    - Dosing: comments, instrument, sample, molecule (substance), duration, pressure
    - SRD: comments, support files, molecule
    - System Handover (NEEDED????): Instrument, Vacuum system status, cryo-system status, cangas bottles, additional notes/observations, newly occurring errors, work performed during tip time

Meeting with Bruno:
    Only show dat parameters if a group of dat files
    Sort by name, date, etc.
    The samples created during a sample preparation should not be shown. Just the one used in the measurement.
    Select molecule in openbis and it appears in aiidalab.
    Ask Simone about dynamic functions while the creation of objects.

4-10-2024:
Send updated Python Uploader to Adam
Send examples files to populate the gallery.
Measurement properties are not going to be saved inside an object but rather inside the config file.
